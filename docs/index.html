<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 注专转 转</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .package-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 30px;
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 3px dashed #667eea;
            animation: pulse-border 2s infinite;
        }
        .package-container.disabled {
             cursor: not-allowed;
             opacity: 0.8;
        }
        .package-container:hover {
            transform: scale(1.05);
            border-color: #ff6b6b;
        }
        @keyframes pulse-border {
            0%, 100% { border-color: #667eea; }
            50% { border-color: #ff6b6b; }
        }
        .package-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: all 0.5s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            padding: 20px;
            box-sizing: border-box;
            -webkit-backface-visibility: hidden; /* Fix for animation flickering */
            backface-visibility: hidden;
        }
        .layer-1 { background: linear-gradient(45deg, #ff6b6b, #ee5a52); z-index: 29; }
        .layer-2 { background: linear-gradient(45deg, #4ecdc4, #44a08d); z-index: 28; }
        .layer-3 { background: linear-gradient(45deg, #45b7d1, #2980b9); z-index: 27; }
        .layer-4 { background: linear-gradient(45deg, #f093fb, #f5576c); z-index: 26; }
        .layer-5 { background: linear-gradient(45deg, #4facfe, #00f2fe); z-index: 25; }
        .layer-6 { background: linear-gradient(45deg, #43e97b, #38f9d7); z-index: 24; }
        .layer-7 { background: linear-gradient(45deg, #fa709a, #fee140); z-index: 23; }
        .layer-8 { background: linear-gradient(45deg, #a8edea, #fed6e3); z-index: 22; }
        .layer-9 { background: linear-gradient(45deg, #ffecd2, #fcb69f); z-index: 21; }
        .layer-10 { background: linear-gradient(45deg, #667eea, #764ba2); z-index: 20; }
        .layer-11 { background: linear-gradient(45deg, #96fbc4, #f9f047); z-index: 19; }
        .layer-12 { background: linear-gradient(45deg, #ffecd2, #fcb69f); z-index: 18; }
        .layer-13 { background: linear-gradient(45deg, #fccb90, #d57eeb); z-index: 17; }
        .layer-14 { background: linear-gradient(45deg, #e0c3fc, #9bb5ff); z-index: 16; }
        .layer-15 { background: linear-gradient(45deg, #fbd3e9, #bb377d); z-index: 15; }
        .layer-16 { background: linear-gradient(45deg, #89f7fe, #66a6ff); z-index: 14; }
        .layer-17 { background: linear-gradient(45deg, #fdbb2d, #22c1c3); z-index: 13; }
        .layer-18 { background: linear-gradient(45deg, #ff9a9e, #fecfef); z-index: 12; }
        .layer-19 { background: linear-gradient(45deg, #a18cd1, #fbc2eb); z-index: 11; }
        .layer-20 { background: linear-gradient(45deg, #667eea, #764ba2); z-index: 10; }
        .layer-21 { background: linear-gradient(45deg, #667eea, #764ba2); z-index: 9; }
        .layer-22 { background: linear-gradient(45deg, #ff9a9e, #fecfef); z-index: 8; }
        .layer-23 { background: linear-gradient(45deg, #a18cd1, #fbc2eb); z-index: 7; }
        .layer-24 { background: linear-gradient(45deg, #fad0c4, #ffd1ff); z-index: 6; }
        .layer-25 { background: linear-gradient(45deg, #ff8a80, #ffb74d); z-index: 5; }
        .layer-26 { background: linear-gradient(45deg, #81c784, #aed581); z-index: 4; }
        .layer-27 { background: linear-gradient(45deg, #64b5f6, #42a5f5); z-index: 3; }
        .layer-28 { background: linear-gradient(45deg, #ffd54f, #ffecb3); z-index: 2; }
        .layer-29 { background: linear-gradient(45deg, #fccb90, #d57eeb); z-index: 1; }
        
        .layer-removed {
            animation: tearAway 0.8s ease-out forwards;
        }
        .current-player { /* ... all other CSS is unchanged ... */ }
        .instructions { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px; color: #495057; font-size: 1.1em; }
        .controls { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        .btn { padding: 12px 25px; border: none; border-radius: 25px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); }
        .btn-success { background: linear-gradient(45deg, #56ab2f, #a8e6cf); }
        .btn-warning { background: linear-gradient(45deg, #f093fb, #f5576c); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .player-setup { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .player-input { padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1em; margin: 10px; width: 200px; }
        .player-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0; }
        .player-tag { background: linear-gradient(45deg, #4ecdc4, #44a08d); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .game-over { background: linear-gradient(45deg, #56ab2f, #a8e6cf); color: white; padding: 30px; border-radius: 20px; font-size: 1.5em; font-weight: bold; margin: 20px 0; }
        .layer-counter { position: absolute; top: -10px; right: -10px; background: #ff6b6b; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 100; }
        .player-selection { background: linear-gradient(45deg, #ffeaa7, #fab1a0); border-radius: 15px; padding: 20px; margin: 20px 0; display: none; }
        .player-selection h3 { color: #2d3436; margin-bottom: 15px; }
        .player-buttons { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; max-width: 100%; }
        .player-btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 15px 25px; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 1.1em; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); min-width: 120px; text-align: center; }
        .player-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); background: linear-gradient(45deg, #764ba2, #667eea); }
        .player-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .used-players { color: #666; font-size: 0.9em; margin-top: 10px; }
        .confetti { position: fixed; width: 10px; height: 10px; z-index: 9999; pointer-events: none; }
        .confetti.red { background: #ff6b6b; } .confetti.blue { background: #4ecdc4; } .confetti.yellow { background: #feca57; } .confetti.green { background: #48dbfb; } .confetti.purple { background: #ff9ff3; } .confetti.orange { background: #ff9f43; }
        .celebration-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 9998; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .celebration-text { color: white; font-size: 4em; font-weight: bold; text-align: center; margin-bottom: 20px; animation: rainbow 2s infinite; }
        .celebration-subtext { color: white; font-size: 2em; text-align: center; animation: pulse 1s infinite; }
        @keyframes tearAway { 0% { transform: scale(1) rotate(0deg); opacity: 1; } 100% { transform: scale(0) rotate(45deg) translateY(-100px); opacity: 0; z-index: 0 !important; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px) rotate(-1deg); } 75% { transform: translateX(5px) rotate(1deg); } }
        @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes rainbow { 0% { color: #ff6b6b; } 16% { color: #4ecdc4; } 32% { color: #45b7d1; } 48% { color: #f093fb; } 64% { color: #4facfe; } 80% { color: #43e97b; } 100% { color: #ff6b6b; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title">  注专转 转</h1>
        <p class="subtitle">砖拽 拽爪转  转 '2 爪驻转</p>
        <div id="setup-phase">
            <div class="player-setup">
                <h3>专转 砖拽/转</h3>
                <input type="text" id="playerName" class="player-input" placeholder="住/ 砖 转/">
                <button id="addPlayerBtn" class="btn btn-primary">住祝/ 砖拽/转</button>
                <button id="clearPlayersBtn" class="btn btn-warning">拽/  砖转</button>
                <div id="playerList" class="player-list"></div>
                <button id="startBtn" class="btn btn-success" disabled>转/ 砖拽!</button>
            </div>
        </div>
        <div id="game-phase" style="display: none;">
            <div class="current-player" id="currentPlayer"></div>
            <div class="instructions" id="mainInstructions"> 抓/ 注   驻转 砖 转 转 砖! </div>
            <div class="package-container" id="packageContainer">
                <div class="layer-counter" id="layerCounter">29</div>
                <div class="package-layer layer-1" id="layer1">抓/ !</div>
                <div class="package-layer layer-2" id="layer2">砖 2</div><div class="package-layer layer-3" id="layer3">砖 3</div><div class="package-layer layer-4" id="layer4">砖 4</div><div class="package-layer layer-5" id="layer5">砖 5</div><div class="package-layer layer-6" id="layer6">砖 6</div><div class="package-layer layer-7" id="layer7">砖 7</div><div class="package-layer layer-8" id="layer8">砖 8</div><div class="package-layer layer-9" id="layer9">砖 9</div><div class="package-layer layer-10" id="layer10">砖 10</div><div class="package-layer layer-11" id="layer11">砖 11</div><div class="package-layer layer-12" id="layer12">砖 12</div><div class="package-layer layer-13" id="layer13">砖 13</div><div class="package-layer layer-14" id="layer14">砖 14</div><div class="package-layer layer-15" id="layer15">砖 15</div><div class="package-layer layer-16" id="layer16">砖 16</div><div class="package-layer layer-17" id="layer17">砖 17</div><div class="package-layer layer-18" id="layer18">砖 18</div><div class="package-layer layer-19" id="layer19">砖 19</div><div class="package-layer layer-20" id="layer20">砖 20</div><div class="package-layer layer-21" id="layer21">砖 21</div><div class="package-layer layer-22" id="layer22">砖 22</div><div class="package-layer layer-23" id="layer23">砖 23</div><div class="package-layer layer-24" id="layer24">砖 24</div><div class="package-layer layer-25" id="layer25">砖 25</div><div class="package-layer layer-26" id="layer26">砖 26</div><div class="package-layer layer-27" id="layer27">砖 27</div><div class="package-layer layer-28" id="layer28">砖 28</div><div class="package-layer layer-29" id="layer29">驻转注!</div>
            </div>
            <div class="player-selection" id="playerSelection">
                <h3> <span id="currentPlayerName"></span> 专/  注专 转 !</h3>
                <div class="instructions" style="margin: 15px 0; font-size: 1em;"> 专/ 转 转/ 砖 转/ 砖 砖拽专转</div>
                <div class="player-buttons" id="playerButtons"></div>
                <div class="used-players" id="usedPlayers"></div>
            </div>
            <div class="controls">
                <button id="resetBtn" class="btn btn-warning"> 转/ 砖拽 砖</button>
            </div>
        </div>
        <div id="game-over" style="display: none;">
            <div class="game-over"> 砖拽 住转! <br>   砖拽/转!</div>
            <button id="newGameBtn" class="btn btn-primary">转/ 砖拽 砖</button>
        </div>
    </div>

<script>
    // --- DOM Elements ---
    const packageContainer = document.getElementById('packageContainer');
    const playerSelectionDiv = document.getElementById('playerSelection');
    const mainInstructions = document.getElementById('mainInstructions');
    const layerCounter = document.getElementById('layerCounter');
    
    // --- State Variables ---
    let players = [];
    let currentPlayerIndex = 0;
    let currentLayer = 1;
    const totalLayers = 29;
    let gameStarted = false;
    let layerIdToRemove = null;

    const tasks = [
        "砖/ 转  注专转 转/ 砖专/转 驻 拽注 转 住驻专", "砖/ 转  注专转 转/ 砖转专/转  专 砖注专", "砖/ 转  注专转 转/ 砖爪拽/ 转 转 注转 拽专转", "砖/ 转  注专转 转/ 砖转砖/转 住 驻转", "砖/ 转  注专转 转/ 砖拽砖/转 驻 拽注 爪转 砖注专...", "砖/ 转  注专转 转/ 砖拽砖/转 驻 拽注 专 砖注专 驻砖", "砖/ 转  注专转 转/  专抓/ 转", "砖/ 转  注专转 转/ 砖爪注/ /转 驻砖 砖 转转", "砖/ 转  注专转 转/ 砖注/ 专砖/ 拽专 转", "砖/ 转  注专转 转/ 砖 转 砖专 砖注专 住驻专", "砖/ 转  注专转 转/ 砖驻驻/转 注转 拽专转 砖注专...", "砖/ 转  注专转 转/ 驻注/ 专转转", "砖/ 转  注专转 转/ 砖  爪/ 驻 砖/", "砖/ 转  注专转 转/ 砖/转 砖专 注 拽 转", "砖/ 转  注专转 转/ 砖转 注专/转 专", "砖/ 转  注专转 转/ 砖 住专/  ", "砖/ 转  注专转 转/ 注 爪  ", "砖/ 转  注专转 转/ 专/转 转专", "砖/ 转  注专转 转/ 砖 驻住驻住/转 祝 注", "砖/ 转  注专转 转/ 砖驻注/ 住驻 转转", "砖/ 转  注专转 转/  / ", "砖/ 转  注专转 转/ 砖转 砖 / 爪", "砖/ 转  注专转 转/ 注/转 转 转转", "砖/ 转  注专转 转/ 砖转 砖/转 ' 砖 注?'", "砖/ 转  注专转 转/ 砖专/ 转  住专转", "砖/ 转  注专转 转/ 砖转 转/转 注爪转 转", "砖/ 转  注专转 转/ 砖祝 驻注  爪注拽/转"
    ];

    // --- Core Game Functions ---

    function revealTask() {
        console.log(`Revealing task for layer ${currentLayer}`);
        // Disable clicking on the package while choosing a player
        packageContainer.classList.add('disabled');
        
        const layer = document.getElementById(`layer${currentLayer}`);
        if (!layer) return;

        layerIdToRemove = layer.id; // Mark this layer for removal

        // Display task if applicable
        if (currentLayer > 1 && currentLayer < totalLayers) {
            const taskIndex = currentLayer - 2;
            layer.innerHTML = `<div style="font-size: 0.8em; margin-bottom: 10px; color: #fff; font-weight: bold;">砖 ${currentLayer - 1}</div><div style="font-size: 1.1rem; line-height: 1.4;">${tasks[taskIndex]}</div>`;
            mainInstructions.textContent = '拽专/ 转 砖 专/  注专 转  ';
        } else {
            mainInstructions.textContent = '专/  注专 转  ';
        }
        
        showPlayerSelection();
    }

    function passPackage(selectedPlayerName) {
        console.log(`Passing package to ${selectedPlayerName}. Removing layer ${layerIdToRemove}.`);
        
        // 1. Remove the old layer
        if (layerIdToRemove) {
            const layerToRemove = document.getElementById(layerIdToRemove);
            if(layerToRemove) {
                layerToRemove.classList.add('layer-removed');
            }
        }
        
        // 2. Hide player selection
        playerSelectionDiv.style.display = 'none';
        
        // 3. Update state for the next turn
        layerCounter.textContent = totalLayers - currentLayer;
        currentLayer++;
        currentPlayerIndex = players.findIndex(p => p === selectedPlayerName);
        
        // 4. Check for game over
        if (currentLayer > totalLayers) {
            setTimeout(endGame, 1000);
        } else {
            updateCurrentPlayer();
            mainInstructions.textContent = ' 抓/ 注   驻转 砖 转 转 砖! ';
            packageContainer.classList.remove('disabled'); // Re-enable clicking
        }
    }
    
    function endGame() {
        startConfettiCelebration();
        setTimeout(() => {
            document.getElementById('game-phase').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
        }, 4000);
    }
    
    function showPlayerSelection() {
        const currentPlayerName = document.getElementById('currentPlayerName');
        const playerButtons = document.getElementById('playerButtons');
        
        currentPlayerName.textContent = players[currentPlayerIndex];
        
        const availablePlayers = players.filter((_, index) => index !== currentPlayerIndex);
        playerButtons.innerHTML = availablePlayers.map(player => 
            `<button class="player-btn" onclick="passPackage('${player}')">${player}</button>`
        ).join('');

        playerSelectionDiv.style.display = 'block';
    }

    function updateCurrentPlayer() {
        document.getElementById('currentPlayer').textContent = `转专 砖: ${players[currentPlayerIndex]}`;
    }

    // --- Setup and Reset ---
    // (These functions are mostly unchanged but included for completeness)
    
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('addPlayerBtn').addEventListener('click', () => {
             const playerNameInput = document.getElementById('playerName');
             const playerName = playerNameInput.value.trim();
             if (playerName && !players.includes(playerName)) {
                 players.push(playerName);
                 document.getElementById('playerList').innerHTML = players.map(p => `<span class="player-tag">${p}</span>`).join('');
                 playerNameInput.value = '';
                 document.getElementById('startBtn').disabled = players.length < 2;
             }
        });
        
        document.getElementById('clearPlayersBtn').addEventListener('click', () => {
            players = [];
            document.getElementById('playerList').innerHTML = '';
            document.getElementById('startBtn').disabled = true;
        });
        
        document.getElementById('startBtn').addEventListener('click', () => {
            if (players.length < 2) return;
            gameStarted = true;
            document.getElementById('setup-phase').style.display = 'none';
            document.getElementById('game-phase').style.display = 'block';
            updateCurrentPlayer();
        });

        packageContainer.addEventListener('click', () => {
            if (gameStarted && !packageContainer.classList.contains('disabled')) {
                revealTask();
            }
        });

        document.getElementById('resetBtn').addEventListener('click', resetGame);
        document.getElementById('newGameBtn').addEventListener('click', resetGame);
    });
    
    function resetGame() {
        if (gameStarted && !confirm(' 转/ /? 砖拽 转 砖.')) {
            return;
        }
        
        // Reset state
        players = [];
        currentPlayerIndex = 0;
        currentLayer = 1;
        gameStarted = false;
        layerIdToRemove = null;

        // Reset UI
        document.getElementById('setup-phase').style.display = 'block';
        document.getElementById('game-phase').style.display = 'none';
        document.getElementById('game-over').style.display = 'none';
        playerSelectionDiv.style.display = 'none';
        mainInstructions.textContent = ' 抓/ 注   驻转 砖 转 转 砖! ';
        document.getElementById('playerList').innerHTML = '';
        document.getElementById('startBtn').disabled = true;
        document.getElementById('playerName').value = '';
        packageContainer.classList.remove('disabled');
        layerCounter.textContent = totalLayers;
        
        for (let i = 1; i <= totalLayers; i++) {
            const layer = document.getElementById(`layer${i}`);
            if (layer) {
                layer.classList.remove('layer-removed');
                layer.innerHTML = (i === 1) ? '抓/ !' : (i < totalLayers) ? `砖 ${i}` : '驻转注!';
            }
        }
    }
    
    function startConfettiCelebration() { /* This function is unchanged */ 
        const overlay = document.createElement('div');
        overlay.className = 'celebration-overlay';
        overlay.style.display = 'flex';
        overlay.innerHTML = `<div class="celebration-text">   转! </div><div class="celebration-subtext">住转/ 转  砖转!</div>`;
        document.body.appendChild(overlay);

        const colors = ['red', 'blue', 'yellow', 'green', 'purple', 'orange'];
        for (let i = 0; i < 100; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = `confetti ${colors[Math.floor(Math.random() * colors.length)]}`;
                confetti.style.left = Math.random() * 100 + 'vw';
                const duration = Math.random() * 3 + 2;
                confetti.style.animation = `confetti-fall ${duration}s linear`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), duration * 1000);
            }, i * 50);
        }
    }
    
</script>

</body>
</html>
